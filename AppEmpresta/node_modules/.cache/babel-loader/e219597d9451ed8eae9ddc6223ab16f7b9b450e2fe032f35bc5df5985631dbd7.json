{"ast":null,"code":"var _jsxFileName = \"D:\\\\Faculdade\\\\6\\xB0 Semestre\\\\Arquitetura de Software\\\\software_emprestimo\\\\AppEmpresta\\\\src\\\\view\\\\pages\\\\RegistrarDevolucaoPage.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { livroService } from '../services/api';\nimport './FormPages.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RegistrarDevolucaoPage = () => {\n  _s();\n  const navigate = useNavigate();\n  const [livrosEmprestados, setLivrosEmprestados] = useState([]);\n  const [selectedLivroId, setSelectedLivroId] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [initialLoading, setInitialLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [success, setSuccess] = useState(null);\n  useEffect(() => {\n    const fetchLivrosEmprestados = async () => {\n      try {\n        // Buscar todos os livros e filtrar os emprestados\n        const livros = await livroService.listarTodos();\n        const emprestados = livros.filter(livro => livro.status === 'emprestado');\n        setLivrosEmprestados(emprestados);\n      } catch (error) {\n        console.error('Erro ao carregar livros emprestados:', error);\n        setError('Erro ao carregar livros emprestados. Por favor, recarregue a página.');\n      } finally {\n        setInitialLoading(false);\n      }\n    };\n    fetchLivrosEmprestados();\n  }, []);\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!selectedLivroId) {\n      setError('Selecione um livro para registrar a devolução.');\n      return;\n    }\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Atualizar o status do livro para disponível\n      await livroService.atualizarStatus({\n        id: Number(selectedLivroId),\n        status: 'disponivel'\n      });\n      setSuccess('Devolução registrada com sucesso!');\n      setSelectedLivroId('');\n\n      // Atualizar lista de livros emprestados\n      const livros = await livroService.listarTodos();\n      const emprestados = livros.filter(livro => livro.status === 'emprestado');\n      setLivrosEmprestados(emprestados);\n\n      // Redirecionar após um breve intervalo\n      setTimeout(() => {\n        navigate('/');\n      }, 2000);\n    } catch (error) {\n      console.error('Erro ao registrar devolução:', error);\n      setError('Erro ao registrar devolução. Por favor, tente novamente.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  if (initialLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: \"Carregando livros emprestados...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"form-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"page-title\",\n      children: \"Registrar Devolu\\xE7\\xE3o\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 17\n    }, this), success && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"success-message\",\n      children: success\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"form\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"livro\",\n          className: \"form-label\",\n          children: \"Livro\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          id: \"livro\",\n          className: \"form-select\",\n          value: selectedLivroId,\n          onChange: e => setSelectedLivroId(e.target.value),\n          required: true,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"Selecione um livro\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 13\n          }, this), livrosEmprestados.map(livro => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: livro.id,\n            children: [livro.titulo, \" - \", livro.autor]\n          }, livro.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 11\n        }, this), livrosEmprestados.length === 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"form-error\",\n          children: \"N\\xE3o h\\xE1 livros emprestados no momento.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"button button-primary\",\n          disabled: loading || livrosEmprestados.length === 0,\n          children: loading ? 'Registrando...' : 'Registrar Devolução'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, this);\n};\n_s(RegistrarDevolucaoPage, \"nDrYJMj1BR4az2BnUvSgKIt8SxI=\", false, function () {\n  return [useNavigate];\n});\n_c = RegistrarDevolucaoPage;\nexport default RegistrarDevolucaoPage;\nvar _c;\n$RefreshReg$(_c, \"RegistrarDevolucaoPage\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","livroService","jsxDEV","_jsxDEV","RegistrarDevolucaoPage","_s","navigate","livrosEmprestados","setLivrosEmprestados","selectedLivroId","setSelectedLivroId","loading","setLoading","initialLoading","setInitialLoading","error","setError","success","setSuccess","fetchLivrosEmprestados","livros","listarTodos","emprestados","filter","livro","status","console","handleSubmit","e","preventDefault","atualizarStatus","id","Number","setTimeout","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","htmlFor","value","onChange","target","required","map","titulo","autor","length","type","disabled","_c","$RefreshReg$"],"sources":["D:/Faculdade/6° Semestre/Arquitetura de Software/software_emprestimo/AppEmpresta/src/view/pages/RegistrarDevolucaoPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { livroService, emprestimoService } from '../services/api';\r\nimport { Livro } from '../models/types';\r\nimport './FormPages.css';\r\n\r\nconst RegistrarDevolucaoPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [livrosEmprestados, setLivrosEmprestados] = useState<Livro[]>([]);\r\n  const [selectedLivroId, setSelectedLivroId] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [initialLoading, setInitialLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchLivrosEmprestados = async () => {\r\n      try {\r\n        // Buscar todos os livros e filtrar os emprestados\r\n        const livros = await livroService.listarTodos();\r\n        const emprestados = livros.filter((livro: Livro) => livro.status === 'emprestado');\r\n        \r\n        setLivrosEmprestados(emprestados);\r\n      } catch (error) {\r\n        console.error('Erro ao carregar livros emprestados:', error);\r\n        setError('Erro ao carregar livros emprestados. Por favor, recarregue a página.');\r\n      } finally {\r\n        setInitialLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchLivrosEmprestados();\r\n  }, []);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!selectedLivroId) {\r\n      setError('Selecione um livro para registrar a devolução.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      // Atualizar o status do livro para disponível\r\n      await livroService.atualizarStatus({\r\n        id: Number(selectedLivroId),\r\n        status: 'disponivel'\r\n      });\r\n      \r\n      setSuccess('Devolução registrada com sucesso!');\r\n      setSelectedLivroId('');\r\n      \r\n      // Atualizar lista de livros emprestados\r\n      const livros = await livroService.listarTodos();\r\n      const emprestados = livros.filter((livro: Livro) => livro.status === 'emprestado');\r\n      setLivrosEmprestados(emprestados);\r\n      \r\n      // Redirecionar após um breve intervalo\r\n      setTimeout(() => {\r\n        navigate('/');\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error('Erro ao registrar devolução:', error);\r\n      setError('Erro ao registrar devolução. Por favor, tente novamente.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (initialLoading) {\r\n    return <div className=\"loading\">Carregando livros emprestados...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"form-page\">\r\n      <h1 className=\"page-title\">Registrar Devolução</h1>\r\n      \r\n      {error && <div className=\"error-message\">{error}</div>}\r\n      {success && <div className=\"success-message\">{success}</div>}\r\n      \r\n      <form onSubmit={handleSubmit} className=\"form\">\r\n        <div className=\"form-group\">\r\n          <label htmlFor=\"livro\" className=\"form-label\">Livro</label>\r\n          <select\r\n            id=\"livro\"\r\n            className=\"form-select\"\r\n            value={selectedLivroId}\r\n            onChange={(e) => setSelectedLivroId(e.target.value)}\r\n            required\r\n          >\r\n            <option value=\"\">Selecione um livro</option>\r\n            {livrosEmprestados.map((livro) => (\r\n              <option key={livro.id} value={livro.id}>\r\n                {livro.titulo} - {livro.autor}\r\n              </option>\r\n            ))}\r\n          </select>\r\n          {livrosEmprestados.length === 0 && (\r\n            <p className=\"form-error\">Não há livros emprestados no momento.</p>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"form-actions\">\r\n          <button \r\n            type=\"submit\" \r\n            className=\"button button-primary\"\r\n            disabled={loading || livrosEmprestados.length === 0}\r\n          >\r\n            {loading ? 'Registrando...' : 'Registrar Devolução'}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RegistrarDevolucaoPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}